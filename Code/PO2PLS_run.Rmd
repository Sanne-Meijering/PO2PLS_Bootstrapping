---
title: "PO2PLS_run"
author: "Sanne"
date: "November 5, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Setup

```{r}
# Get packages
library(OmicsPLS)
library(data.table)
library(PO2PLS)
# Set seed
set.seed(31*12*2016)

# Load the chromosome 17 data
setwd("C:/Users/rikul/Documents/Thesis_data")
load("Xy_chr17.Rdata")

# Draw subjects
sample <- sort(sample(1:nrow(X), 1000))

# Filter subjects
Xtrain <- X[sample,]
ytrain <- y[sample,]
```



# Cross-validation


```{r}
set.seed(724264)

#Crossvalidation with max. 3 components
crossval_o2m_adjR2(Xtrain, ytrain, 1:3, 0:3, 0:3, nr_folds=5)
# ny=3 for all top results, so repeat with higher max ny
crossval_o2m_adjR2(Xtrain, ytrain, 1:2, 0:4, 2:4, nr_folds=5)
# nx=3 and ny=3:4, repeat with higher max ny
crossval_o2m_adjR2(Xtrain, ytrain, 1, 0:5, 2:5, nr_folds=5)
# n=1 nx=3 & ny=4 for best results, same results as for previous test

# Check with full cross-validation
crossval_o2m(Xtrain, ytrain, 1:2, 0:4, 0:4, nr_folds=5)
# Best at n=1 nx=1 ny=4
```


# Running PO2PLS

```{r}
set.seed(3284773)
Psteps2000_x1 <- PO2PLS(Xtrain, ytrain, 1, 3, 4, steps=2000)
#save(Psteps2000_x1, "Psteps2000_x1", file="PO2PLSn1x3y4")
#load("PO2PLSn1x3y4")
```


```{r}
summary(Psteps2000_x1)
param <- Psteps2000_x1$parameters
```

```{r}
# Plot results
#plot(param$W[,1], param$W[,2], xlab="First component", ylab="Second component")
#abline(h=0)
#abline(v=0)
#plot(param$C[,1], param$C[,2], pch=as.character(1:7), xlab="First component", ylab="Second component")
#abline(h=0)
#abline(v=0)

param <- Psteps2000_x1$parameters
plot(param$W[,1])
which.max(param$W[,1])
which.max(param$Wo[,3])
plot(param$Wo[,1])
plot(param$Wo[,2])
plot(param$Wo[,3])
plot(colMeans(Xtrain))
sd(Xtrain%*%param$W[,1])
sd(colSums(Xtrain))/sqrt(ncol(Xtrain))

colnames(Xtrain)[3350:3400]
```
```{r}
plot(param$W[,1], ylab="First component", main="Genes")
abline(h=0)
#plot(param$W[,2], ylab="Second component", main="Genes")
#abline(h=0)
plot(param$C[,1], ylab="First component", pch=as.character(1:7), main="Outcomes")
abline(h=0)
#plot(param$C[,2], ylab="Second component", pch=as.character(1:7), main="Outcomes")
#abline(h=0)
```

```{r}
# Compare with O2PLS results
O2PLS_res <- o2m(Xtrain, ytrain, 1, 3, 4)
summary(O2PLS_res)
# Plot joined components
plot(O2PLS_res, "Xj")
plot(O2PLS_res, "Yj")

# Plot specific component of X
plot(O2PLS_res, "Xo")

# It seems there is one area with extreme values, which ended up in the specific part in O2PLS and in the joined part in PO2PLS
```



To do

Gene Ontology (GO, look into it)
>GSEA (look into it) MAGMA/VEGAS
With specific parts and without specific parts (0)
Top genes!
```

